
<!---

Whoa! What are you doing here? Don't you know that academic code is
dangerous, ugly, and harmful to your health? Surely, some cats do it
right, but the beauty of this website (why thank you!) is only skin
deep (I promise).

If you're looking for our javascript code, the good stuff is in calculate-examples.js.

The rest is pretty nasty.

-->

<head>

  <script language="JavaScript" type="text/javascript" src="flotr-0.1.0alpha.js"></script>
  <script language="JavaScript" type="text/javascript" src="calculate-misc.js"></script>
  <script language="JavaScript" type="text/javascript" src="calculate-examples.js"></script>
  <link href="jquery-ui.css" rel="stylesheet" type="text/css"/>
  <script language="JavaScript" type="text/javascript" src="jquery-1.6.2.min.js"></script>
  <script language="JavaScript" type="text/javascript" src="jquery-ui-1.8.16.custom.min.js"></script>
  <script language="JavaScript" type="text/javascript" src="prototype-1.6.0.2.js"></script>
 
 <script>
     jQuery.noConflict();
 </script>



<title>Probabilistic Bounded Staleness</title>
<link rel=StyleSheet href="bootstrap.min.css" type="text/css">
<link rel=StyleSheet href="consistency.css" type="text/css">

<script type="text/javascript">
var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-27366179-1']);
  _gaq.push(['_trackPageview']); (function() { var ga =
  document.createElement('script'); ga.type = 'text/javascript';
  ga.async = true; ga.src = ('https:' == document.location.protocol ?
  'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s
  = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(ga, s); })();
</script>

</head>

<body>

    <header class="jumbotron masthead" id="overview">
      <div class="inner">
        <div class="container">
          <h1>PBS: Probabilistically Bounded Staleness</h1>
          <p class="lead">
	    How eventual is eventual consistency? How consistent is
	    eventual consistency?<br />  PBS provides answers to these
	    questions using new techniques and simple modeling.<br />  Find
	    out how and play with models in your browser on this
	    page.<br />
        </div><!-- /container -->
      </div>
    </header>

    <div class="topbar">
      <div class="fill">
        <div class="container">
          <a class="brand" href="#">PBS: Probabilistically Bounded Staleness</a>
          <ul class="nav">
            <li><a href="#about">About</a></li>
            <li><a href="#instructions">Instructions</a></li>
            <li><a href="#demo">Demo</a></li>
            <li><a href="#questions">Questions</a></li>
            <li><a href="#moreinfo">More Info</a></li>
            <li><a href="#thanks">Thanks</a></li>
          </ul>
        </div>
      </div>
    </div>


<div class="container">
<div class="content">

<section id="about">

<div class="page-header"> <h1>PBS in Brief <small>  What is PBS and why should you care?</small></h1></div>


<blockquote>
    <p>"All good ideas arrive by chance."</p>
    <small>Max Ernst</small>
</blockquote>

foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz 
</section>


<section id="instructions">
<div class="page-header"> <h1>Instructions <small> Prepare yourself for greatness.</small></h1> </div>
foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz 
</section>

<section id="demo">
<div class="page-header"> <h1>How Eventual is Eventual Consistency? <small> PBS in action under Dynamo-style quorums</small> </h1></div>
<center>
  <div id="plot">
  <span class="graph-label">P(Consistency)</span>
  <div id="tcdf" style="width:920px;height:250px;"></div>
    <span class="big-axis-label">Time After Commit (ms)</span><br/>
  </div>
</center>

<p><span id="sweept"></span></p>


<div class="row">
  <div class="span4 show-grid">
    <div id="nrwpanel">
<b>Replica Configuration</b><br/>
<span class="slidewraplt">N:</span> <div class="jqslider" id="n-jsslider"></div><span class="slidewraprt" id="Nslider">3</span><br>
<span class="slidewraplt">R:</span> <div class="jqslider" id="r-jsslider"></div><span class="slidewraprt" id="Rslider">1</span><br>
<span class="slidewraplt">W:</span> <div class="jqslider" id="w-jsslider"></div><span class="slidewraprt" id="Wslider">1</span><br>

</div>
</div>

<div class="span8" id="latencystat">
<div id="statfloat">
Read Latency: Median <span id="rlatency"></span> ms, 99.9th %ile <span id="rlatencypct"></span> ms<br>
Write Latency: Median <span id="wlatency"></span> ms, 99.9th %ile <span id="wlatencypct"></span> ms<br>
</div>
</div>

<div class="span4 show-grid">
    <div id="nrwpanel">
<b>Tolerable Staleness:</b> <span class="slidewrap" id="kslider">1 version</span><br>
<div class="jqsliderbig" id="k-jsslider"></div><br>
<b>Accuracy:</b> <span class="slidewrap" id="itslider">2500</span> iterations/point</br>
 <div class="jqsliderbig" id="it-jsslider"></div><br>
</div>
</div>
</div>

</center>

<script type="text/javascript">

var p = [];

function makeReadSlider(N)
{
    var R = document.getElementById("Rslider").innerHTML; 
    if(R > N)
    {
        R = N;
        document.getElementById("Rslider").innerHTML = R;
    }
   
    jQuery("#r-jsslider").slider({ min: 1, max: N, value: R, change: function(event, ui) { showR(ui.value); }  });
}


function makeWriteSlider(N)
{
    var W = document.getElementById("Wslider").innerHTML;
    if(W > N)
    {
        W = N;
        document.getElementById("Wslider").innerHTML = W;
    }

    jQuery("#w-jsslider").slider({ min: 1, max: N, value: W, change: function(event, ui) { showW(ui.value); }  });
}


  var loaded = false;

    document.observe('dom:loaded', function(){

    jQuery("#n-jsslider").slider({ min: 1, max: 9, value: 3, change: function(event, ui) { showN(ui.value); }  });
    jQuery("#k-jsslider").slider({ min: 1, max: 9, value: 1, change: function(event, ui) { showK(ui.value); }  });
    jQuery("#it-jsslider").slider({ min: 100, max: 15000, value: 2500, change: function(event, ui) { showIt(ui.value); }  });
    jQuery("#wl-jsslider").slider({ min: 10, max: 1500, value: 100, change: function(event, ui) { editWLambda(ui.value); }  });
    jQuery("#al-jsslider").slider({ min: 10, max: 1500, value: 100, change: function(event, ui) { editALambda(ui.value); }  });
    jQuery("#rl-jsslider").slider({ min: 10, max: 1500, value: 100, change: function(event, ui) { editRLambda(ui.value); }  });
    jQuery("#sl-jsslider").slider({ min: 10, max: 1500, value: 100, change: function(event, ui) { editSLambda(ui.value); }  });

    makeReadSlider(3);
    makeWriteSlider(3);
    editWLambda(100);
    editRLambda(100);
    editALambda(100);
    editSLambda(100);
    updateReadLatency();
    updateWriteLatency();
    loaded = true;
    updateProbability();
		       });

function updateReadLatency()
{
    var N = document.getElementById("Nslider").innerHTML;
    var R = document.getElementById("Rslider").innerHTML;
    var Rl = document.getElementById("rlambda").innerHTML;
    var Sl = document.getElementById("slambda").innerHTML;

    // it's inefficient to do this twice, but the example code suffers otherwise...
    document.getElementById("rlatency").innerHTML = roundNumber(calculate_read_latency(N, R, Rl, Sl, .5),2);
    document.getElementById("rlatencypct").innerHTML = roundNumber(calculate_read_latency(N, R, Rl, Sl, .999),2);
}

function updateWriteLatency()
{
    var N = document.getElementById("Nslider").innerHTML;
    var W = document.getElementById("Wslider").innerHTML;
    var Wl = document.getElementById("wlambda").innerHTML;
    var Al = document.getElementById("alambda").innerHTML;

    document.getElementById("wlatency").innerHTML = roundNumber(calculate_write_latency(N, W, Wl, Al, .5), 2);
    document.getElementById("wlatencypct").innerHTML = roundNumber(calculate_write_latency(N, W, Wl, Al, .999), 2);
}

function updateProbability()
{
    if(!loaded)
        return;

    var N = parseInt(document.getElementById("Nslider").innerHTML);
    var R = parseInt(document.getElementById("Rslider").innerHTML);
    var W = parseInt(document.getElementById("Wslider").innerHTML);
    var k = parseInt(document.getElementById("kslider").innerHTML);
    var Wl = document.getElementById("wlambda").innerHTML;
    var Al = document.getElementById("alambda").innerHTML;
    var Rl = document.getElementById("rlambda").innerHTML;
    var Sl = document.getElementById("slambda").innerHTML;

    var showtimes = [0, 10, 100];
    var st = 0;
    var resultHTML=""

    for(st = 0; st < showtimes.length; st++)
    {
	if(st != 0)
            resultHTML+="<br>"

	var thisps;

        if(R+W<= N)
	{
	    thisps = roundNumber(100*Math.min(MAX_PS,calc_prob_stale(N, R, W, Wl, Al, Rl, Sl, showtimes[st], k)), 2);
	    resultHTML+="You have at least a "+thisps+" percent chance of reading";
	}
	else
	{
	    thisps = 100;
	    resultHTML+="You are guaranteed to read";
        }

        if(k==1)
            resultHTML+=" the last written version";
	else
            resultHTML+=" one of the last "+k+" written versions";

        resultHTML+= " "+showtimes[st]+" ms after";

        if(k==1)
            resultHTML+=" it commits.";
	else
            resultHTML+=" they commit.";
    }

    document.getElementById("sweept").innerHTML = resultHTML;

    var ps_at_five = calc_prob_stale(N, R, W, Wl, Al, Rl, Sl, 5, k);
    var ps_at_ten = calc_prob_stale(N, R, W, Wl, Al, Rl, Sl, 10, k);

    var maxt = 30;
    var step = 2;

    if(ps_at_five > .99)
    {
       maxt = 5;
       step = .5;
    }
    else if(ps_at_ten > .99)
    {
       maxt = 10;
       step = 1;
    }
    p = [];
    for(var ts = 0; ts < maxt; ts+=step)
    { 
        var ps = calc_prob_stale(N, R, W, Wl, Al, Rl, Sl, ts, k);
        p.push([ts, ps]);
        if(ps > .9999 && p.length>5)
            break;
    }

    var f = Flotr.draw(
      $('tcdf'), 
      [ p ],
      {mouse:{
      track: true,
      lineColor: 'blue',
      sensibility: 1, // => The smaller this value, the more precise you've to point
      trackDecimals: 3,
      trackFormatter: function(obj){ return 't = ' + roundNumber(obj.x,2) +', Pr = ' + obj.y; }
      }}
      );
}

function showR(R)
{
    document.getElementById("Rslider").innerHTML=R;
    updateProbability();
    updateReadLatency();
}

function showN(N)
{
    document.getElementById("Nslider").innerHTML=N;
    if(document.getElementById("Rslider").innerHTML > N)
      showR(N);
    if(document.getElementById("Wslider").innerHTML > N)
      showW(N);

    makeReadSlider(N);
    updateReadLatency();

    makeWriteSlider(N);
    updateWriteLatency();
    updateProbability();
}

function showW(W)
{
    document.getElementById("Wslider").innerHTML=W;
    updateProbability();
    updateWriteLatency();
}

function showK(k)
{
    var finalstring = " versions";
    if(k == 1)
      finalstring = " version";
      
    document.getElementById("kslider").innerHTML=k+finalstring;
    updateProbability();
}

function showIt(its)
{
    document.getElementById("itslider").innerHTML=its;
    update_max_iterations(its);
    updateProbability();
}

function showT(t)
{
   document.getElementById("tslider").innerHTML=t;
   updateProbability();
}

function editLambda(lmbda, eleid, elecontainer)
{
	document.getElementById(eleid).innerHTML=(lmbda/1000).toFixed(3);
        var d1 = [];
        //for(var i = 0; i < Math.min(20000/lmbda, 300); i += 0.5)
	for(var i = 0; i < 32; i += 0.5)
		       d1.push([i, calc_exponential_cdf(lmbda/1000, i)]);
		   
		   var f = Flotr.draw($(elecontainer), [ d1 ], {xaxis: { tickDecimals: 0 }});
        updateProbability();
}


function editWLambda(wlambda)
{
        editLambda(wlambda, "wlambda", "wcontainer");
	updateWriteLatency();
}

function editALambda(alambda)
{
        editLambda(alambda, "alambda", "acontainer");
	updateWriteLatency();
}

function editRLambda(rlambda)
{
        editLambda(rlambda, "rlambda", "rcontainer");
	updateReadLatency();
}

function editSLambda(slambda)
{
        editLambda(slambda, "slambda", "scontainer");
	updateReadLatency();
}

</script>

<div id="latencypanel" class="span16 show-grid">
<b>Operation Latency</b>: Exponentially Distributed CDFs

<div class="row">
<div class="span4">
  <center>
    <span class="graph-label">Write Request to Replica</span>
    <div id="wcontainer" style="width:180px;height:100px;"></div>
    <span class="axis-label">Latency (ms)</span><br/>
    <span class="lambdalabel">&#x3BB;</span> <div class="lmbda-jqslider" id="wl-jsslider"></div><span id="wlambda">.100</span><br>
  </center>
</div>

<div class="span4">
  <center>
    <span class="graph-label">Replica Write Ack</span>
    <div id="acontainer" style="width:180px;height:100px;"></div>
    <span class="axis-label">Latency (ms)</span><br/>
    <span class="lambdalabel">&#x3BB;</span> <div class="lmbda-jqslider" id="al-jsslider"></div><span id="alambda">.100</span><br>
  </center>
</div>

<div class="span4">
  <center>
    <span class="graph-label">Read Request to Replica</span>
    <div id="rcontainer" style="width:180px;height:100px;"></div>
    <span class="axis-label">Latency (ms)</span><br/>
    <span class="lambdalabel">&#x3BB;</span> <div class="lmbda-jqslider" id="rl-jsslider"></div><span id="rlambda">.100</span><br>
  </center>
</div>

<div class="span4">
  <center>
    <span class="graph-label">Replica Read Response</span>
    <div id="scontainer" style="width:180px;height:100px;"></div>
    <span class="axis-label">Latency (ms)</span><br/>
    <span class="lambdalabel">&#x3BB;</span> <div class="lmbda-jqslider" id="sl-jsslider"></div><span id="slambda">.100</span><br>
  </center>
</div>
</div>

</section>

<section id="questions">
<div class="page-header"> <h1>Questions <small>Because you're too lazy to read our paper. Not really, but you should.</small> </h1> </div>
foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz foo bar baz 
</section>


<section id="moreinfo">
<div class="page-header"> <h1>More Info <small>Awesome! What next?</small></h1> </div>
foo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar bazfoo bar baz
foo bar baz
</section>

<section id="thanks">
<div class="page-header"> <h1>Acknowledgments <small>Wu-Tang is for the children</small></h1> </div>

<p>PBS was developed at UC Berkeley.  The PBS team is 
<a href="http://bailis.org" target="_blank">Peter Bailis</a>,
<a href="http://shivaram.info/" target="_blank">Shivaram Venkataraman</a>,
<a href="http://www.cs.berkeley.edu/~franklin/" target="_blank">Mike Franklin</a>, 
<a href="http://www.cs.berkeley.edu/~istoica/" target="_blank">Ion Stoica</a>, and 
<a href="http://db.cs.berkeley.edu/~jmh/" target="_blank">Joe Hellerstein</a>.</p>

<div id="acks">
<p>Many kind folks provided useful feedback on our work, including
<a href="http://research.microsoft.com/en-us/people/aguilera/" target="_blank">Marcos Aguilera</a>, 
<a href="http://www.cs.berkeley.edu/~palvaro/" target="_blank">Peter Alvaro</a>, 
<a href="http://www.cs.berkeley.edu/~brewer/" target="_blank">Eric Brewer</a>,
<a href="http://www.neilconway.org/" target="_blank">Neil Conway</a>,
<a href="http://www.eecs.berkeley.edu/~gdurrett/" target="_blank">Greg Durrett</a>,
<a href="https://twitter.com/#!/strlen" target="_blank">Alex Feinberg</a>,
<a href="http://www.sics.se/~ali/" target="_blank">Ali Ghodsi</a>,
<a href="http://www.cs.berkeley.edu/~haryadi/" target="_blank">Hariyadi Gunawi</a>,
<a href="http://codahale.com/" target="_blank">Coda Hale</a>,
<a href="http://www.eecs.harvard.edu/~bkate/" target="_blank">Bryan Kate</a>,
<a href="http://db.csail.mit.edu/madden/" target="_blank">Sam Madden</a>,
<a href="http://www.eecs.berkeley.edu/~wrm/" target="_blank">Bill Marczak</a>,
<a href="https://twitter.com/#!/kayousterhout" target="_blank">Kay Ousterhout</a>,
<a href="http://pages.cs.wisc.edu/~chrisre/" target="_blank">Christopher Re</a>,
<a href="http://www.eecs.berkeley.edu/Faculty/Homepages/shenker.html" target="_blank">Scott Shenker</a>,
<a href="http://www.malhar.net/sriram/" target="_blank">Sriram Srinivasan</a>,
<a href="http://research.microsoft.com/en-us/people/terry/" target="_blank">Doug Terry</a>,
<a href="http://www.cs.berkeley.edu/~gvaliant/" target="_blank">Greg Valiant</a>, and 
<a href="http://www.eecs.berkeley.edu/~pwendell/" target="_blank">Patrick Wendell</a>.
This acknowledgement does not imply any sort of endorsement--just a
pleasant thank-you.  Any errors or inaccuracies are attributable to the authors
alone.</p>

<p>This work was supported in part by <a href="http://amplab.cs.berkeley.edu/">AMPLab</a> gifts from Google, SAP,
Amazon Web Services, Cloudera, Ericsson, Huawei, IBM, Intel,
MarkLogic, Microsoft, NEC Labs, NetApp, Oracle, Splunk, and VMware and
by DARPA (contract #FA8650-11-C-7136).  This material is based upon
work supported by the National Science Foundation Graduate Research
Fellowship under Grant No. DGE 1106400.</p>
</div>
</section>



    <footer class="footer">
      <div class="container">
        <p class="pull-right"><a href="#">Back to top</a></p>
        <p>
	  This page's design and layout were shamelessly cobbled together
          using <a href="http://twitter.github.com/bootstrap/" target="_blank">Bootstrap</a>
          and its provided sample
          code.  <a href="http://solutoire.com/flotr/" target="_blank">Flotr</a>
          powers the graph visualization with
          some <a href="http://jqueryui.com/" target="_blank">jQuery UI</a> thrown in
          for good measure.  This page was built by <a href="http://bailis.org/"
          target="_blank">Peter Bailis</a>
          (<a href="http://twitter.com/pbailis"
          target="_blank">@pbailis</a>) and the PBS team<br />.
        </p>
      </div>
    </footer>


</body>
